<!DOCTYPE html>
<html lang="gu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Royal Beauty Jewellery</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #c5a059; --dark: #1a1a1a; --light: #ffffff; }
        body { margin: 0; padding-bottom: 80px; background-color: var(--dark); color: var(--light); font-family: 'Poppins', sans-serif; }
        
        /* рк╣рлЗркбрк░ ркЕркирлЗ ркбрк┐ркЭрк╛ркИрки */
        header { background: #000; padding: 15px; position: sticky; top: 0; z-index: 100; border-bottom: 1px solid var(--primary); display: flex; justify-content: space-between; align-items: center; }
        h1 { margin: 0; font-family: 'Playfair Display', serif; color: var(--primary); font-size: 1.2rem; }
        
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 10px; }
        .card { background: #222; border-radius: 10px; overflow: hidden; border: 1px solid #333; }
        .card img { width: 100%; height: 160px; object-fit: cover; }
        .info { padding: 10px; text-align: center; }
        .price { color: var(--primary); font-weight: bold; }
        .add-btn { background: var(--primary); border: none; width: 100%; padding: 5px; margin-top: 5px; font-weight: bold; cursor: pointer; }

        /* Admin Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; color: #000; z-index: 200; overflow-y: auto; }
        .modal-header { padding: 15px; background: #eee; display: flex; justify-content: space-between; align-items: center; font-weight: bold; }
        .close-btn { font-size: 1.5rem; cursor: pointer; background: none; border: none; }
        
        /* Floating Button */
        .admin-float-btn { position: fixed; bottom: 80px; right: 20px; background: #333; color: var(--primary); border: 2px solid var(--primary); width: 50px; height: 50px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 24px; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.5); z-index: 90; }

        /* Upload Section Styles */
        .upload-box { background: #f9f9f9; padding: 15px; text-align: center; border-bottom: 2px solid #ddd; }
        .file-input { display: none; }
        .custom-file-btn { background: var(--dark); color: var(--primary); padding: 10px 20px; border-radius: 5px; cursor: pointer; display: inline-block; font-weight: bold; margin-bottom: 10px; }
        .status-text { font-size: 12px; color: green; font-weight: bold; display: none; }
        .copy-hint { font-size: 11px; color: #555; margin-top: 5px; }

        iframe { width: 100%; height: 70vh; border: none; }
    </style>
</head>
<body>

<header>
    <h1>тЬи Royal Jewellery</h1>
    <div onclick="openCart()">ЁЯЫТ <span id="count">0</span></div>
</header>

<div id="loader" style="text-align:center; padding:20px;">Loading...</div>
<div class="grid" id="grid"></div>

<div class="admin-float-btn" onclick="openAdmin()" title="Add Item">+</div>

<div id="adminModal" class="modal">
    <div class="modal-header">
        <span>ркирк╡рлА рк╡рк╕рлНркдрлБ ркЙркорлЗрк░рлЛ</span>
        <button class="close-btn" onclick="closeAdmin()">├Ч</button>
    </div>

    <div class="upload-box">
        <p style="margin:0 0 10px 0; font-weight:bold;">Step 1: рклрлЛркЯрлЛ ркЕрккрк▓рлЛркб ркХрк░рлЛ</p>
        
        <label class="custom-file-btn">
            ЁЯУ╖ ркХрлЗркорлЗрк░рк╛ ркЪрк╛рк▓рлБ ркХрк░рлЛ / рклрлЛркЯрлЛ рккрк╕ркВркж ркХрк░рлЛ
            <input type="file" class="file-input" id="fileInput" accept="image/*" capture="environment" onchange="uploadImage()">
        </label>
        
        <div id="uploadStatus" style="margin-top:5px; color:#666;">рк╣ркЬрлБ ркХрлЛркИ рклрлЛркЯрлЛ рккрк╕ркВркж ркХрк░рлНркпрлЛ ркиркерлА.</div>
        <div id="successMsg" class="status-text">тЬЕ рк▓рк┐ркВркХ ркХрлЛрккрлА ркеркИ ркЧркИ! рк╣рк╡рлЗ ркирлАркЪрлЗ рклрлЛрк░рлНркоркорк╛ркВ Paste ркХрк░рлЛ.</div>
    </div>

    <div style="padding:10px; background:#eee; text-align:center; font-weight:bold; border-bottom:1px solid #ccc;">
        Step 2: рк╡рк┐ркЧркд ркнрк░рлЛ & Submit ркХрк░рлЛ
    </div>

    <iframe id="adminFrame" src=""></iframe>
</div>

<div id="cartModal" class="modal" style="top:unset; bottom:0; height:auto; border-radius:20px 20px 0 0;">
    <div class="modal-header">
        <span>Your Cart</span>
        <button class="close-btn" onclick="closeCart()">├Ч</button>
    </div>
    <div id="cartList" style="padding:15px;"></div>
    <div style="padding:15px; border-top:1px solid #ccc;">
        <h3>Total: <span id="total">тВ╣0</span></h3>
        <button onclick="order()" style="width:100%; background:#25D366; color:white; padding:10px; border:none; border-radius:5px;">Order on WhatsApp</button>
    </div>
</div>

<script>
    // ******************************************************
    // ркдркорк╛рк░рлА рк╡рк┐ркЧркдрлЛ ркЕрк╣рлАркВ ркнрк░рлЛ (ркзрлНркпрк╛ркиркерлА)
    // ******************************************************
    
    // 1. Google Sheet CSV Link
    const SHEET_URL = "https://docs.google.com/spreadsheets/d/1d0VJykhlYbM_Mc6UtZJF49NWXiYifExYdSUjEbVNARU/edit?usp=drivesdk"; 
    
    // 2. Google Form Link
    const FORM_URL = "https://docs.google.com/forms/d/15PBpEvf78mfay68TyZT5zzZhXb1iscT3fx5vn1HR1cc/edit#responses";

    // 3. ImgBB API Key (ркЬрлЗ ркдркорлЗ рк╕рлНркЯрлЗркк рлз ркорк╛ркВ ркорлЗрк│рк╡рлА)
    const API_KEY = "245def2987b781c5a65854cd82809f9c"; 
    
    // ******************************************************

    // --- Image Upload Logic ---
    function uploadImage() {
        const input = document.getElementById('fileInput');
        const status = document.getElementById('uploadStatus');
        const success = document.getElementById('successMsg');
        
        if (input.files && input.files[0]) {
            status.innerText = "рклрлЛркЯрлЛ ркЕрккрк▓рлЛркб ркеркИ рк░рк╣рлНркпрлЛ ркЫрлЗ... ркХрлГрккрк╛ ркХрк░рлАркирлЗ рк░рк╛рк╣ ркЬрлБркУ...";
            success.style.display = 'none';

            let formData = new FormData();
            formData.append("image", input.files[0]);

            fetch('https://api.imgbb.com/1/upload?key=' + API_KEY, {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const imgLink = data.data.url;
                    // рк▓рк┐ркВркХ ркЖрккрлЛркЖркк ркХрлЛрккрлА ркХрк░рлЛ
                    navigator.clipboard.writeText(imgLink).then(() => {
                        status.innerText = "ркЕрккрк▓рлЛркб ркеркИ ркЧркпрлБркВ!";
                        success.style.display = 'block';
                        alert("рк▓рк┐ркВркХ ркХрлЛрккрлА ркеркИ ркЧркИ ркЫрлЗ! рк╣рк╡рлЗ ркирлАркЪрлЗ рклрлЛрк░рлНркоркорк╛ркВ 'Image Link' ркЦрк╛ркирк╛ркорк╛ркВ Paste ркХрк░рлА ркжрлЛ.");
                    });
                } else {
                    status.innerText = "ркнрлВрк▓ ркЖрк╡рлА. рклрк░рлА рккрлНрк░ркпркдрлНрки ркХрк░рлЛ.";
                }
            })
            .catch(error => {
                console.error('Error:', error);
                status.innerText = "ркЗркирлНркЯрк░ркирлЗркЯ ркХркирлЗркХрлНрк╢рки ркдрккрк╛рк╕рлЛ.";
            });
        }
    }

    // --- ркмрк╛ркХрлАркирлЛ ркХрлЛркб (рк╕рлЗрко ркЯрлБ рк╕рлЗрко) ---
    let products = [];
    let cart = {};

    function openAdmin() {
        if(FORM_URL.includes("YOUR")) alert("рклрлЛрк░рлНрко рк▓рк┐ркВркХ ркорлВркХрк╡рк╛ркирлА ркмрк╛ркХрлА ркЫрлЗ!");
        else {
            document.getElementById('adminFrame').src = FORM_URL;
            document.getElementById('adminModal').style.display = 'block';
        }
    }
    function closeAdmin() { document.getElementById('adminModal').style.display = 'none'; location.reload(); }

    async function loadProducts() {
        if(SHEET_URL.includes("YOUR")) {
             products = [{id:1, name:"Demo Necklace", price:500, image:"https://via.placeholder.com/150"}];
             render(); document.getElementById('loader').style.display='none'; return;
        }
        try {
            const res = await fetch(SHEET_URL);
            const text = await res.text();
            products = csvToJson(text);
            document.getElementById('loader').style.display = 'none';
            render();
        } catch (e) { console.log(e); }
    }

    function csvToJson(csv) {
        const lines = csv.split('\n');
        const result = [];
        for(let i=1; i<lines.length; i++) {
            if(!lines[i].trim()) continue;
            const row = lines[i].split(',');
            // Google Form Timestamp adjustment
            const obj = {
                id: i,
                name: row[1]?.trim(),
                price: parseInt(row[2]?.trim()) || 0,
                image: row[4]?.trim() || "https://via.placeholder.com/150"
            };
            if(obj.name) result.push(obj);
        }
        return result.reverse();
    }

    function render() {
        const grid = document.getElementById('grid');
        grid.innerHTML = '';
        products.forEach(p => {
            grid.innerHTML += `
                <div class="card">
                    <img src="${p.image}" onerror="this.src='https://via.placeholder.com/150'">
                    <div class="info">
                        <div>${p.name}</div>
                        <div class="price">тВ╣${p.price}</div>
                        <button class="add-btn" onclick="add(${p.id})">ADD</button>
                    </div>
                </div>`;
        });
    }

    function add(id) { 
        if(cart[id]) cart[id].qty++; else cart[id]={...products.find(p=>p.id===id),qty:1}; 
        updateCart(); 
    }
    function updateCart() {
        let total=0, count=0;
        let html = '';
        Object.values(cart).forEach(i=>{
            total+=i.price*i.qty; count+=i.qty;
            html+=`<div>${i.name} (${i.qty}) - тВ╣${i.price*i.qty}</div>`;
        });
        document.getElementById('cartList').innerHTML = html;
        document.getElementById('total').innerText = 'тВ╣'+total;
        document.getElementById('count').innerText = count;
    }
    function openCart() { document.getElementById('cartModal').style.display = 'block'; }
    function closeCart() { document.getElementById('cartModal').style.display = 'none'; }
    function order() {
        let msg = "Order:%0A"; Object.values(cart).forEach(i=>msg+=`- ${i.name} (${i.qty})%0A`);
        window.open(`https://wa.me/919999999999?text=${msg}`);
    }

    loadProducts();
</script>
</body>
</html>